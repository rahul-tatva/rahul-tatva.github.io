const MOBILE_WIDTH = 480, TRENDII_NATIVE_ADS_CDN = "https://cdn.trendii.com/native-ads-sdk/assets", AD_PRODUCTS_CONTAINER = "trendii-sdk-ad-products-container", PUBLISHER_NAME = "DAILY_MAIL", RETAILER_LOGO_ID = "retailer-logo", DESKTOP_DAILY_MAIL_IMAGE_SELECTOR_CLASS = ".blkBorder.img-share", DESKTOP_DAILY_MAIL_LOADED_IMAGE_SELECTOR_CLASS = ".blkBorder.img-share.b-loaded", MOBILE_DAILY_MAIL_IMAGE_SELECTOR_CLASS = ".img-share", MOBILE_DAILY_MAIL_LOADED_IMAGE_SELECTOR_CLASS = ".img-share.b-loaded", DESKTOP_IMAGE_GROUP_PARENT_DIV_CLASS = ".mol-img-group", MOBILE_IMAGE_GROUP_PARENT_TAG = "figure", DESKTOP_DAILY_MAIL_IMAGE_CAPTION_CLASS = "imageCaption", MOBILE_DAILY_MAIL_IMAGE_CAPTION_TAG = "figcaption", RETAILER_NAME_TO_REPLACE_WITH = "{{RETAILER_NAME}}", SLIDER_CLASS_TO_REPLACE_WITH = "trendiiSliderUniqueString", SCRIPT_ID_TO_REPLACE = "trendiiSliderUniqueString-script"; var adsWindow = window.top, adsDOM = adsWindow.document; class TRENDiiAd { constructor() { this.loadScriptIntoHead("https://cdn.trendii.com/native-ads-sdk/intersection-observer.min.js"), this.loadScriptIntoHead("https://cdn.trendii.com/assets/splide.min.js"), this.loadStyleSheetIntoHead("https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css"), this.loadStyleSheetIntoHead("https://cdn.trendii.com/assets/splide-core.min.css"), this.loadStyleSheetIntoHead("https://cdn.trendii.com/native-ads-sdk/trendii-sdk-daily-mail-slider.css"), this.loadStyleSheetIntoHead("https://cdn.trendii.com/native-ads-sdk/trendii-sdk-daily-mail-all-product.css"), console.log("sdk constructor initialized"), this.feedProducts = [], this.intersectionObserver, this.API_GET_NATIVE_AD_SLIDER_TEMPLATE = `https://cdn.trendii.com/native-ads-sdk/Products-Slider-dynamic.html`, this.API_GET_NATIVE_AD_SIMPLE_TEMPLATE = `https://cdn.trendii.com/native-ads-sdk/Products-728X90-all-product-dynamic.html`, this.HTML_TEMPLATE_SIMPLE_CONTAINER_ID = "trendii-products-container-728X90", this.nativeAdSimpleTemplateHTMLString = null, this.nativeAdSliderTemplateHTMLString = null, this.API_GET_NATIVE_AD_PRODUCT = `https://beeswaxcreatives.trendii.com/img-creatives`, this.HTML_TEMPLATE_AD_WRAPPER_ID = "trendii-native-ad-wrapper", this.HTML_TEMPLATE_SLIDER_CONTAINER_ID = "trendii-sdk-ad-products-container", this.slidersAppendedArray = [], this.sliderCount = 0, "complete" === adsDOM.readyState ? (console.log("complete"), this.startAdGenerationProcess()) : "interactive" === adsDOM.readyState ? (console.log("interactive"), this.startAdGenerationProcess()) : (console.log("DOM in progress"), adsDOM.addEventListener("DOMContentLoaded", () => { console.log("DOMContentLoaded"), this.startAdGenerationProcess(); })); } startAdGenerationProcess() { Promise.all([fetch(this.API_GET_NATIVE_AD_SLIDER_TEMPLATE).then(e => e.text()), fetch(this.API_GET_NATIVE_AD_SIMPLE_TEMPLATE).then(e => e.text())]).then(e => { this.nativeAdSliderTemplateHTMLString = e[0], this.nativeAdSimpleTemplateHTMLString = e[1]; const t = { rootMargin: "0px", threshold: .1 }; this.intersectionObserver = adsWindow.IntersectionObserverV1 ? new adsWindow.IntersectionObserverV1(this.handleIntersectionEntries.bind(this), t) : new IntersectionObserver(this.handleIntersectionEntries.bind(this), t); let d; d = adsWindow.innerWidth <= MOBILE_WIDTH ? Array.from(adsDOM.querySelectorAll(MOBILE_IMAGE_GROUP_PARENT_TAG)) : Array.from(adsDOM.querySelectorAll(DESKTOP_IMAGE_GROUP_PARENT_DIV_CLASS)), d.forEach(e => { this.intersectionObserver.observe(e); }), this.log(this.feedProducts); }); } loadStyleSheetIntoHead(e) { var t = adsDOM.createElement("link"); t.type = "text/css", t.rel = "stylesheet", t.href = e, adsDOM.head.appendChild(t); } loadScript(e) { adsDOM.body.appendChild(adsDOM.createElement("script")).src = e; } loadScriptIntoHead(e) { adsDOM.head.appendChild(adsDOM.createElement("script")).src = e; } handleIntersectionEntries(e, t) { e.forEach(e => { if (e.isIntersecting) { const d = e.target; t.unobserve(e.target), console.log("observer unregistered for ", d); const a = Array.from(d.getElementsByTagName("img")), n = a.map(e => e.getAttribute("data-src") ? e.getAttribute("data-src") : e.getAttribute("src")).filter(e => e), r = { webpageUrl: adsWindow.location.href, imageUrls: n, publisherId: 2 }, i = new Headers; i.append("Content-Type", "application/json"); const l = JSON.stringify(r); fetch(this.API_GET_NATIVE_AD_PRODUCT, { method: "POST", headers: i, body: l }).then(e => e.json()).then(e => { if (!("" !== e)) this.log("empty feed response"); else if (e.success && !0 === e.success) { const t = e; let n = null, r = null; for (let e = 0; e < a.length; e++) { const d = a[e], i = d.src, l = d.getAttribute("data-src"); if (r = t.payload.findIndex(e => e.imageUrl === i || l), n = t.payload[r], n.products && 0 < n.products.length) { break; } } if (n.products && 0 < n.products.length && (this.generatedAdForSingleImage(n, this.sliderCount), this.sliderCount++, n.generatedAdHTML)) { if (adsWindow.innerWidth <= MOBILE_WIDTH) { const e = d.getElementsByTagName(MOBILE_DAILY_MAIL_IMAGE_CAPTION_TAG)[0]; e ? e.after(n.generatedAdHTML) : d.appendChild(n.generatedAdHTML); } else d.getElementsByClassName(DESKTOP_DAILY_MAIL_IMAGE_CAPTION_CLASS)[0].after(n.generatedAdHTML), n.isAdGenerated = !0, console.log("ad rendered for ", d); const e = n.sliderId; if (n.isSliderTemplate && (this.slidersAppendedArray.push(n.sliderId), console.log(adsWindow.Splide), adsWindow.Splide)) { const t = new adsWindow.Splide(`#${e}`, { type: "loop", pagination: !1, gap: 10, autoWidth: !0, autoHeight: !0 }).mount(), d = adsDOM.getElementById(e); d.style.display = "block"; const a = n.generatedAdHTML; a.setAttribute("data-slider-appended", "true"), a.style.display = "block", this.log("slider appended"), t.on("mounted", function () { console.log("mounted"); }); } } } }).catch(e => { console.error(e), "function" == typeof onErrorCallback && onErrorCallback(e); }); } }); } generatedAdForSingleImage(e, t) { const d = this.createAdsForAllProductsInAdvance(e, t); e.generatedAdHTML = d; } createAdTemplatesForAllProducts() { this.feedProducts.payload.map((e, t) => { if (e.products && 0 < e.products.length) { const d = this.createAdsForAllProductsInAdvance(e, t); e.generatedAdHTML = d; } }); } createAdsForAllProductsInAdvance(e, t) { const d = e.imageUrl, a = e.advertiserName; let n = e.products; adsWindow.innerWidth > MOBILE_WIDTH && (n = e.products.slice(0, 4)); const r = e.advertiserName, i = `splide${t}`; switch (e.sliderId = i, n.length) { case 1: case 2: case 3: case 4: { e.isSliderTemplate = !1; const t = new DOMParser, d = t.parseFromString(this.nativeAdSimpleTemplateHTMLString, "text/html"), a = `${TRENDII_NATIVE_ADS_CDN}/${r.toLowerCase()}.png`, i = d.getElementById(RETAILER_LOGO_ID); i.title = r, i.src = a; const l = d.getElementById(this.HTML_TEMPLATE_SIMPLE_CONTAINER_ID); l.innerHTML = "", initializeRenderingProductsBasedOnCount(n, l); const s = d.getElementById(this.HTML_TEMPLATE_AD_WRAPPER_ID); return s; } default: { e.isSliderTemplate = !0; const t = this.nativeAdSliderTemplateHTMLString.replaceAll(SLIDER_CLASS_TO_REPLACE_WITH, i), d = new DOMParser, a = d.parseFromString(t, "text/html"), l = `${TRENDII_NATIVE_ADS_CDN}/${r.toLowerCase()}.png`, s = a.getElementById(RETAILER_LOGO_ID); s.title = r, s.src = l; const c = a.getElementById(i); c.style.display = "none"; let p = a.getElementById(this.HTML_TEMPLATE_SLIDER_CONTAINER_ID); p.innerHTML = "", n.forEach(e => this.createSliderItemProduct(e, p)); const o = a.getElementById(this.HTML_TEMPLATE_AD_WRAPPER_ID); return o.style.display = "none", o; } } } getAllParentImageGroupClassMobile() { let e; e = adsWindow.innerWidth <= MOBILE_WIDTH ? adsDOM.querySelectorAll(MOBILE_IMAGE_GROUP_PARENT_TAG) : adsDOM.querySelectorAll(DESKTOP_IMAGE_GROUP_PARENT_DIV_CLASS), this.parentImageGroupElements = Array.from(e), this.log(this.parentImageGroupElements); let t = null; this.parentImageGroupElements.forEach(e => { this.log(e.getElementsByTagName("img")); const d = Array.from(e.getElementsByTagName("img")); for (let a = 0; a < d.length; a++) { const e = d[a], n = e.src, r = e.getAttribute("data-src"); if (t = this.feedProducts.payload.find(e => e.imageUrl === n || r), t.generatedAdHTML) { break; } } if (t.generatedAdHTML) { const d = adsDOM.createElement("div"); d.classList.add("adContainer"), d.style.background = "yellow", d.style.maxHeight = "300px"; const a = adsDOM.createElement("div"); if (a.classList.add("ads-inside-the-images"), adsWindow.innerWidth < MOBILE_WIDTH) { const d = e.getElementsByTagName(MOBILE_DAILY_MAIL_IMAGE_CAPTION_TAG)[0]; d ? d.after(t.generatedAdHTML) : e.appendChild(t.generatedAdHTML); } else e.getElementsByClassName(DESKTOP_DAILY_MAIL_IMAGE_CAPTION_CLASS)[0].after(t.generatedAdHTML); } }); } getAllAdContainersFromDOM() { } log(e) { console.log(e); } createSliderItemProduct(e, t) { const d = adsDOM.createElement("LI"); d.classList.add("splide__slide"), t.appendChild(d); const a = adsDOM.createElement("A"); a.classList.add("product-redirection-link"), a.style = "text-decoration: none;", a.href = e.url, a.target = "_blank", d.appendChild(a); const n = adsDOM.createElement("DIV"); n.classList.add("product-item-container"), n.addEventListener("click", function () { adsWindow.open(e.url, "_blank"); }), a.appendChild(n); const r = adsDOM.createElement("DIV"); if (r.classList.add("product-item"), r.style.backgroundImage = `url(${e.image})`, n.appendChild(r), e.sale) { const e = adsDOM.createElement("SPAN"); e.classList.add("onsale"), e.innerHTML = "ON SALE", r.appendChild(e); } const i = adsDOM.createElement("DIV"); i.classList.add("product-details-wrapper"), r.appendChild(i), i.addEventListener("click", function () { adsWindow.open(e.url, "_blank"); }); const l = adsDOM.createElement("DIV"); l.classList.add("product-details-wrapper-mobile"), n.appendChild(l); const s = adsDOM.createElement("P"); s.classList.add("product-name"), s.innerHTML = e.name, i.appendChild(s); const c = adsDOM.createElement("P"); c.classList.add("product-name"), c.innerHTML = e.name, l.appendChild(c); const p = adsDOM.createElement("EM"); p.classList.add("product-price"), p.innerHTML = e.currency + e.price, i.appendChild(p); const o = adsDOM.createElement("EM"); o.classList.add("product-price"), o.innerHTML = e.currency + e.price, l.appendChild(o); } } (function () { var e = new TRENDiiAd; e.log("initialize new instance"); })(); function initializeRenderingProductsBasedOnCount(e, t) { switch (e.length) { case 1: { const d = e[0], a = adsDOM.createElement("DIV"); a.classList.add("one-product-wrapper"), t.appendChild(a); const n = adsDOM.createElement("DIV"); n.classList.add("row"), a.appendChild(n); const r = adsDOM.createElement("DIV"); r.classList.add("col-12"), n.appendChild(r); const i = adsDOM.createElement("A"); i.classList.add("product-redirection-link"), i.style = "text-decoration: none;", i.href = d.url, i.target = "_blank", r.appendChild(i); const l = adsDOM.createElement("DIV"); l.classList.add("product-item-container"), l.addEventListener("click", function () { adsWindow.open(d.url, "_blank"); }), i.appendChild(l); const s = adsDOM.createElement("DIV"); s.classList.add("product-item"), l.appendChild(s); const c = adsDOM.createElement("DIV"); if (c.classList.add("product-item-image"), c.style.backgroundImage = `url(${d.image})`, s.appendChild(c), d.sale) { const e = adsDOM.createElement("SPAN"); e.classList.add("onsale"), e.innerHTML = "ON SALE", c.appendChild(e); } const p = adsDOM.createElement("DIV"); p.classList.add("product-details-wrapper"), l.appendChild(p); const o = adsDOM.createElement("P"); o.classList.add("product-name"), o.innerHTML = d.name, p.appendChild(o); const m = adsDOM.createElement("EM"); m.classList.add("product-price"), m.innerHTML = d.currency + d.price, p.appendChild(m); break; } case 2: { const d = adsDOM.createElement("DIV"); d.classList.add("two-product-wrapper"), t.appendChild(d); const a = adsDOM.createElement("DIV"); a.classList.add("row"), d.appendChild(a); for (let t = 0; 1 >= t; t++) { const d = e[t], n = adsDOM.createElement("DIV"); n.classList.add("col-6"), a.appendChild(n); const r = adsDOM.createElement("DIV"); r.classList.add("product-item-container"), r.addEventListener("click", function () { adsWindow.open(d.url, "_blank"); }), n.appendChild(r); const i = adsDOM.createElement("DIV"); i.classList.add("product-item"), r.appendChild(i); const l = adsDOM.createElement("DIV"); l.classList.add("product-item-image"), l.style.backgroundImage = `url(${d.image})`, i.appendChild(l); const s = adsDOM.createElement("DIV"); s.classList.add("product-details-wrapper"), r.appendChild(s); const c = adsDOM.createElement("P"); c.classList.add("product-name"), c.innerHTML = d.name, s.appendChild(c); const p = adsDOM.createElement("EM"); p.classList.add("product-price"), p.innerHTML = d.currency + d.price, s.appendChild(p); } break; } case 3: { const d = adsDOM.createElement("DIV"); d.classList.add("three-product-wrapper"), t.appendChild(d); const a = adsDOM.createElement("DIV"); a.classList.add("row"), a.classList.add("row-cols-3"), d.appendChild(a); for (let t = 0; 2 >= t; t++) { const d = e[t], n = adsDOM.createElement("DIV"); n.classList.add("col"), a.appendChild(n); const r = adsDOM.createElement("A"); r.classList.add("product-redirection-link"), r.href = d.url, r.target = "_blank", n.appendChild(r); const i = adsDOM.createElement("DIV"); i.classList.add("product-item-container"), r.appendChild(i); const l = adsDOM.createElement("DIV"); l.classList.add("product-item"), i.appendChild(l); const s = adsDOM.createElement("DIV"); if (s.classList.add("product-item-image"), s.style.backgroundImage = `url(${d.image})`, l.appendChild(s), d.sale) { const e = adsDOM.createElement("SPAN"); e.classList.add("onsale"), e.innerHTML = "ON SALE", s.appendChild(e); } const c = adsDOM.createElement("DIV"); c.classList.add("product-details-wrapper"), i.appendChild(c); const p = adsDOM.createElement("P"); p.classList.add("product-name"), p.innerHTML = d.name, c.appendChild(p); const o = adsDOM.createElement("EM"); o.classList.add("product-price"), o.innerHTML = d.currency + d.price, c.appendChild(o); const m = adsDOM.createElement("DIV"); m.classList.add("product-details-wrapper-mobile"), i.appendChild(m); const E = adsDOM.createElement("P"); E.classList.add("product-name"), E.innerHTML = d.name, m.appendChild(E); const L = adsDOM.createElement("EM"); L.classList.add("product-price"), L.innerHTML = d.currency + d.price, m.appendChild(L); } break; } case 4: { const d = adsDOM.createElement("DIV"); d.classList.add("four-product-wrapper"), t.appendChild(d); const a = adsDOM.createElement("DIV"); a.classList.add("row"), a.classList.add("row-cols-4"), d.appendChild(a); for (let t = 0; 3 >= t; t++) { const d = e[t], n = adsDOM.createElement("DIV"); n.classList.add("col"), a.appendChild(n); const r = adsDOM.createElement("A"); r.classList.add("product-redirection-link"), r.href = d.url, r.target = "_blank", n.appendChild(r); const i = adsDOM.createElement("DIV"); i.classList.add("product-item-container"), r.appendChild(i); const l = adsDOM.createElement("DIV"); l.classList.add("product-item"), i.appendChild(l); const s = adsDOM.createElement("DIV"); if (s.classList.add("product-item-image"), s.style.backgroundImage = `url(${d.image})`, l.appendChild(s), d.sale) { const e = adsDOM.createElement("SPAN"); e.classList.add("onsale"), e.innerHTML = "ON SALE", s.appendChild(e); } const c = adsDOM.createElement("DIV"); c.classList.add("product-details-wrapper"), l.appendChild(c); const p = adsDOM.createElement("P"); p.classList.add("product-name"), p.innerHTML = d.name, c.appendChild(p); const o = adsDOM.createElement("EM"); o.classList.add("product-price"), o.innerHTML = d.currency + d.price, c.appendChild(o); const m = adsDOM.createElement("DIV"); m.classList.add("product-details-wrapper-mobile"), i.appendChild(m); const E = adsDOM.createElement("P"); E.classList.add("product-name"), E.innerHTML = d.name, m.appendChild(E); const L = adsDOM.createElement("EM"); L.classList.add("product-price"), L.innerHTML = d.currency + d.price, m.appendChild(L); } break; } case 5: { const d = adsDOM.createElement("DIV"); d.classList.add("five-product-wrapper"), t.appendChild(d); const a = e[0], n = adsDOM.createElement("DIV"); n.classList.add("row"), d.appendChild(n); const r = adsDOM.createElement("DIV"); r.classList.add("col"), n.appendChild(r); const i = adsDOM.createElement("A"); i.classList.add("product-redirection-link"), i.style = "text-decoration: none;", i.href = a.url, i.target = "_blank", r.appendChild(i); const l = adsDOM.createElement("DIV"); l.classList.add("product-item-container"), l.addEventListener("click", function () { adsWindow.open(a.url, "_blank"); }), i.appendChild(l); const s = adsDOM.createElement("DIV"); if (s.classList.add("product-item"), s.style.backgroundImage = `url(${a.image})`, l.appendChild(s), a.sale) { const e = adsDOM.createElement("SPAN"); e.classList.add("onsale"), e.innerHTML = "ON SALE", s.appendChild(e); } const c = adsDOM.createElement("DIV"); c.classList.add("product-details-wrapper"), s.appendChild(c); const p = adsDOM.createElement("B"); p.classList.add("brand-name"), p.innerHTML = BRAND_NAME, c.appendChild(p); const o = adsDOM.createElement("P"); o.classList.add("product-name"), o.innerHTML = a.name, c.appendChild(o); const m = adsDOM.createElement("EM"); m.classList.add("product-price"), m.innerHTML = a.currency + a.price, c.appendChild(m); let E = 1; for (let t = 1; 2 >= t; t++) { const t = adsDOM.createElement("DIV"); t.classList.add("row"), t.classList.add("secondary-product-row"), d.appendChild(t); for (let d = 1; 2 >= d; d++) { const d = e[E], a = adsDOM.createElement("DIV"); a.classList.add("col-6"), t.appendChild(a); const n = adsDOM.createElement("A"); n.classList.add("product-redirection-link"), n.style = "text-decoration: none;", n.href = d.url, n.target = "_blank", a.appendChild(n); const r = adsDOM.createElement("DIV"); r.classList.add("product-item-container"), r.addEventListener("click", function () { adsWindow.open(d.url, "_blank"); }), n.appendChild(r); const i = adsDOM.createElement("DIV"); if (i.classList.add("product-item"), i.style.backgroundImage = `url(${d.image})`, r.appendChild(i), d.sale) { const e = adsDOM.createElement("SPAN"); e.classList.add("onsale"), e.innerHTML = "ON SALE", i.appendChild(e); } const l = adsDOM.createElement("DIV"); l.classList.add("product-details-wrapper"), i.appendChild(l); const s = adsDOM.createElement("B"); s.classList.add("brand-name"), s.innerHTML = BRAND_NAME, l.appendChild(s); const c = adsDOM.createElement("P"); c.classList.add("product-name"), c.innerHTML = d.name, l.appendChild(c); const p = adsDOM.createElement("EM"); p.classList.add("product-price"), p.innerHTML = d.currency + d.price, l.appendChild(p), E++; } } break; } case 6: { const d = adsDOM.createElement("DIV"); d.classList.add("six-product-wrapper"), t.appendChild(d); let a = 0; for (let t = 1; 3 >= t; t++) { const t = adsDOM.createElement("DIV"); t.classList.add("row"), t.classList.add("secondary-product-row"), d.appendChild(t); for (let d = 1; 2 >= d; d++) { const d = e[a], n = adsDOM.createElement("DIV"); n.classList.add("col-6"), t.appendChild(n); const r = adsDOM.createElement("A"); r.classList.add("product-redirection-link"), r.style = "text-decoration: none;", r.href = d.url, r.target = "_blank", n.appendChild(r); const i = adsDOM.createElement("DIV"); i.classList.add("product-item-container"), i.addEventListener("click", function () { adsWindow.open(d.url, "_blank"); }), r.appendChild(i); const l = adsDOM.createElement("DIV"); if (l.classList.add("product-item"), l.style.backgroundImage = `url(${d.image})`, i.appendChild(l), d.sale) { const e = adsDOM.createElement("SPAN"); e.classList.add("onsale"), e.innerHTML = "ON SALE", l.appendChild(e); } const s = adsDOM.createElement("DIV"); s.classList.add("product-details-wrapper"), l.appendChild(s); const c = adsDOM.createElement("B"); c.classList.add("brand-name"), c.innerHTML = BRAND_NAME, s.appendChild(c); const p = adsDOM.createElement("P"); p.classList.add("product-name"), p.innerHTML = d.name, s.appendChild(p); const o = adsDOM.createElement("EM"); o.classList.add("product-price"), o.innerHTML = d.currency + d.price, s.appendChild(o), a++; } } break; } default: } }