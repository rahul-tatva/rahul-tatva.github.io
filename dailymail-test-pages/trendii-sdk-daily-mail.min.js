const MOBILE_WIDTH = 480, TRENDII_NATIVE_ADS_CDN = "https://cdn.trendii.com/native-ads-sdk/assets", AD_PRODUCTS_CONTAINER = "trendii-sdk-ad-products-container", PUBLISHER_NAME = "DAILY_MAIL", RETAILER_LOGO_ID = "retailer-logo", DESKTOP_DAILY_MAIL_IMAGE_SELECTOR_CLASS = ".blkBorder.img-share", DESKTOP_DAILY_MAIL_LOADED_IMAGE_SELECTOR_CLASS = ".blkBorder.img-share.b-loaded", MOBILE_DAILY_MAIL_IMAGE_SELECTOR_CLASS = ".img-share", MOBILE_DAILY_MAIL_LOADED_IMAGE_SELECTOR_CLASS = ".img-share.b-loaded", DESKTOP_IMAGE_GROUP_PARENT_DIV_CLASS = ".mol-img-group", MOBILE_IMAGE_GROUP_PARENT_TAG = "figure", DESKTOP_DAILY_MAIL_IMAGE_CAPTION_CLASS = "imageCaption", MOBILE_DAILY_MAIL_IMAGE_CAPTION_TAG = "figcaption", RETAILER_NAME_TO_REPLACE_WITH = "{{RETAILER_NAME}}", SLIDER_CLASS_TO_REPLACE_WITH = "trendiiSliderUniqueString", SCRIPT_ID_TO_REPLACE = "trendiiSliderUniqueString-script"; var intersectionObserver, IntersectionObserverV1 = window.IntersectionObserverV1; class TRENDiiAd { constructor() { this.loadScriptIntoHead("https://cdn.trendii.com/native-ads-sdk/intersection-observer.min.js"), this.loadScriptIntoHead("https://cdn.trendii.com/assets/splide.min.js"), this.loadStyleSheetIntoHead("https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css"), this.loadStyleSheetIntoHead("https://cdn.trendii.com/assets/splide-core.min.css"), this.loadStyleSheetIntoHead("https://cdn.trendii.com/native-ads-sdk/trendii-sdk-daily-mail-slider.css"), this.loadStyleSheetIntoHead("https://cdn.trendii.com/native-ads-sdk/trendii-sdk-daily-mail-all-product.css"), console.log("sdk constructor initialized"), this.feedProducts = [], this.intersectionObserver, this.API_GET_NATIVE_AD_SLIDER_TEMPLATE = `https://cdn.trendii.com/native-ads-sdk/Products-Slider-dynamic.html`, this.API_GET_NATIVE_AD_SIMPLE_TEMPLATE = `https://cdn.trendii.com/native-ads-sdk/Products-728X90-all-product-dynamic.html`, this.HTML_TEMPLATE_SIMPLE_CONTAINER_ID = "trendii-products-container-728X90", this.nativeAdSimpleTemplateHTMLString = null, this.nativeAdSliderTemplateHTMLString = null, this.API_GET_NATIVE_AD_PRODUCT = `https://beeswaxcreatives.trendii.com/img-creatives`, this.HTML_TEMPLATE_AD_WRAPPER_ID = "trendii-native-ad-wrapper", this.HTML_TEMPLATE_SLIDER_CONTAINER_ID = "trendii-sdk-ad-products-container", this.slidersAppendedArray = [], this.sliderCount = 0, document.addEventListener("DOMContentLoaded", () => { console.log("DOM is ready"), Promise.all([fetch(this.API_GET_NATIVE_AD_SLIDER_TEMPLATE).then(e => e.text()), fetch(this.API_GET_NATIVE_AD_SIMPLE_TEMPLATE).then(e => e.text())]).then(e => { this.nativeAdSliderTemplateHTMLString = e[0], this.nativeAdSimpleTemplateHTMLString = e[1]; const d = { rootMargin: "0px", threshold: .2 }; intersectionObserver = window.IntersectionObserverV1 ? new IntersectionObserverV1(this.handleIntersectionEntries.bind(this), d) : new IntersectionObserver(this.handleIntersectionEntries.bind(this), d); let t; t = window.innerWidth <= MOBILE_WIDTH ? Array.from(document.querySelectorAll(MOBILE_IMAGE_GROUP_PARENT_TAG)) : Array.from(document.querySelectorAll(DESKTOP_IMAGE_GROUP_PARENT_DIV_CLASS)), t.forEach(e => { intersectionObserver.observe(e); }), this.log(this.feedProducts); }); }); } loadStyleSheetIntoHead(e) { var d = document.createElement("link"); d.type = "text/css", d.rel = "stylesheet", d.href = e, document.head.appendChild(d); } loadScript(e) { document.body.appendChild(document.createElement("script")).src = e; } loadScriptIntoHead(e) { document.head.appendChild(document.createElement("script")).src = e; } handleIntersectionEntries(e, d) { e.forEach(e => { if (e.isIntersecting) { const t = e.target, a = Array.from(t.getElementsByTagName("img")), n = a.map(e => e.getAttribute("src")).filter(e => e), r = { webpageUrl: window.location.href, imageUrls: n, publisherId: 1 }, i = new Headers; i.append("Content-Type", "application/json"); const l = JSON.stringify(r); fetch(this.API_GET_NATIVE_AD_PRODUCT, { method: "POST", headers: i, body: l }).then(e => e.json()).then(n => { if (!("" !== n)) this.log("empty feed response"); else if (n.success && !0 === n.success) { const r = n; let l = null, s = null; for (let e = 0; e < a.length; e++) { const d = a[e], t = d.src, n = d.getAttribute("data-src"); if (s = r.payload.findIndex(e => e.imageUrl === t || n), l = r.payload[s], l.products && 0 < l.products.length) { break; } } if (l.products && 0 < l.products.length && (this.generatedAdForSingleImage(l, this.sliderCount), this.sliderCount++, l.generatedAdHTML)) { if (window.innerWidth <= MOBILE_WIDTH) { const e = t.getElementsByTagName(MOBILE_DAILY_MAIL_IMAGE_CAPTION_TAG)[0]; e ? e.after(l.generatedAdHTML) : t.appendChild(l.generatedAdHTML); } else t.getElementsByClassName(DESKTOP_DAILY_MAIL_IMAGE_CAPTION_CLASS)[0].after(l.generatedAdHTML), l.isAdGenerated = !0, console.log("ad rendered for ", t); const a = l.sliderId; if (l.isSliderTemplate && (this.slidersAppendedArray.push(l.sliderId), console.log(window.Splide), window.Splide)) { const e = new Splide(`#${a}`, { type: "loop", pagination: !1, gap: 10, autoWidth: !0, autoHeight: !0 }).mount(), d = document.getElementById(a); d.style.display = "block"; const t = l.generatedAdHTML; t.setAttribute("data-slider-appended", "true"), t.style.display = "block", this.log("slider appended"), e.on("mounted", function () { console.log("mounted"); }); } d.unobserve(e.target), console.log("observer unregistered for ", t); } } }).catch(e => { console.error(e), "function" == typeof onErrorCallback && onErrorCallback(e); }); } }); } generatedAdForSingleImage(e, d) { const t = this.createAdsForAllProductsInAdvance(e, d); e.generatedAdHTML = t; } createAdTemplatesForAllProducts() { this.feedProducts.payload.map((e, d) => { if (e.products && 0 < e.products.length) { const t = this.createAdsForAllProductsInAdvance(e, d); e.generatedAdHTML = t; } }); } createAdsForAllProductsInAdvance(e, d) { const t = e.imageUrl, a = e.advertiserName; let n = e.products; window.innerWidth > MOBILE_WIDTH && (n = e.products.slice(0, 4)); const r = e.advertiserName, i = `splide${d}`; switch (e.sliderId = i, n.length) { case 1: case 2: case 3: case 4: { e.isSliderTemplate = !1; const d = new DOMParser, t = d.parseFromString(this.nativeAdSimpleTemplateHTMLString, "text/html"), a = `${TRENDII_NATIVE_ADS_CDN}/${r.toLowerCase()}.png`, i = t.getElementById(RETAILER_LOGO_ID); i.title = r, i.src = a; const l = t.getElementById(this.HTML_TEMPLATE_SIMPLE_CONTAINER_ID); l.innerHTML = "", initializeRenderingProductsBasedOnCount(n, l); const s = t.getElementById(this.HTML_TEMPLATE_AD_WRAPPER_ID); return s; } default: { e.isSliderTemplate = !0; const d = this.nativeAdSliderTemplateHTMLString.replaceAll(SLIDER_CLASS_TO_REPLACE_WITH, i), t = new DOMParser, a = t.parseFromString(d, "text/html"), l = `${TRENDII_NATIVE_ADS_CDN}/${r.toLowerCase()}.png`, s = a.getElementById(RETAILER_LOGO_ID); s.title = r, s.src = l; const c = a.getElementById(i); c.style.display = "none"; let p = a.getElementById(this.HTML_TEMPLATE_SLIDER_CONTAINER_ID); p.innerHTML = "", n.forEach(e => this.createSliderItemProduct(e, p)); const o = a.getElementById(this.HTML_TEMPLATE_AD_WRAPPER_ID); return o.style.display = "none", o; } } } getAllParentImageGroupClassMobile() { let e; e = window.innerWidth <= MOBILE_WIDTH ? document.querySelectorAll(MOBILE_IMAGE_GROUP_PARENT_TAG) : document.querySelectorAll(DESKTOP_IMAGE_GROUP_PARENT_DIV_CLASS), this.parentImageGroupElements = Array.from(e), this.log(this.parentImageGroupElements); let d = null; this.parentImageGroupElements.forEach(e => { this.log(e.getElementsByTagName("img")); const t = Array.from(e.getElementsByTagName("img")); for (let a = 0; a < t.length; a++) { const e = t[a], n = e.src, r = e.getAttribute("data-src"); if (d = this.feedProducts.payload.find(e => e.imageUrl === n || r), d.generatedAdHTML) { break; } } if (d.generatedAdHTML) { const t = document.createElement("div"); t.classList.add("adContainer"), t.style.background = "yellow", t.style.maxHeight = "300px"; const a = document.createElement("div"); if (a.classList.add("ads-inside-the-images"), window.innerWidth < MOBILE_WIDTH) { const t = e.getElementsByTagName(MOBILE_DAILY_MAIL_IMAGE_CAPTION_TAG)[0]; t ? t.after(d.generatedAdHTML) : e.appendChild(d.generatedAdHTML); } else e.getElementsByClassName(DESKTOP_DAILY_MAIL_IMAGE_CAPTION_CLASS)[0].after(d.generatedAdHTML); } }); } getAllAdContainersFromDOM() { } log(e) { console.log(e); } createSliderItemProduct(e, d) { const t = document.createElement("LI"); t.classList.add("splide__slide"), d.appendChild(t); const a = document.createElement("A"); a.classList.add("product-redirection-link"), a.style = "text-decoration: none;", a.href = e.url, a.target = "_blank", t.appendChild(a); const n = document.createElement("DIV"); n.classList.add("product-item-container"), n.addEventListener("click", function () { window.open(e.url, "_blank"); }), a.appendChild(n); const r = document.createElement("DIV"); if (r.classList.add("product-item"), r.style.backgroundImage = `url(${e.image})`, n.appendChild(r), e.sale) { const e = document.createElement("SPAN"); e.classList.add("onsale"), e.innerHTML = "ON SALE", r.appendChild(e); } const i = document.createElement("DIV"); i.classList.add("product-details-wrapper"), r.appendChild(i), i.addEventListener("click", function () { window.open(e.url, "_blank"); }); const l = document.createElement("DIV"); l.classList.add("product-details-wrapper-mobile"), n.appendChild(l); const s = document.createElement("P"); s.classList.add("product-name"), s.innerHTML = e.name, i.appendChild(s); const c = document.createElement("P"); c.classList.add("product-name"), c.innerHTML = e.name, l.appendChild(c); const p = document.createElement("EM"); p.classList.add("product-price"), p.innerHTML = e.currency + e.price, i.appendChild(p); const o = document.createElement("EM"); o.classList.add("product-price"), o.innerHTML = e.currency + e.price, l.appendChild(o); } } (function () { var e = new TRENDiiAd; e.log("initialize new instance"); })(); function initializeRenderingProductsBasedOnCount(e, d) { switch (e.length) { case 1: { const t = e[0], a = document.createElement("DIV"); a.classList.add("one-product-wrapper"), d.appendChild(a); const n = document.createElement("DIV"); n.classList.add("row"), a.appendChild(n); const r = document.createElement("DIV"); r.classList.add("col-12"), n.appendChild(r); const i = document.createElement("A"); i.classList.add("product-redirection-link"), i.style = "text-decoration: none;", i.href = t.url, i.target = "_blank", r.appendChild(i); const l = document.createElement("DIV"); l.classList.add("product-item-container"), l.addEventListener("click", function () { window.open(t.url, "_blank"); }), i.appendChild(l); const s = document.createElement("DIV"); s.classList.add("product-item"), l.appendChild(s); const c = document.createElement("DIV"); if (c.classList.add("product-item-image"), c.style.backgroundImage = `url(${t.image})`, s.appendChild(c), t.sale) { const e = document.createElement("SPAN"); e.classList.add("onsale"), e.innerHTML = "ON SALE", c.appendChild(e); } const p = document.createElement("DIV"); p.classList.add("product-details-wrapper"), l.appendChild(p); const o = document.createElement("P"); o.classList.add("product-name"), o.innerHTML = t.name, p.appendChild(o); const m = document.createElement("EM"); m.classList.add("product-price"), m.innerHTML = t.currency + t.price, p.appendChild(m); break; } case 2: { const t = document.createElement("DIV"); t.classList.add("two-product-wrapper"), d.appendChild(t); const a = document.createElement("DIV"); a.classList.add("row"), t.appendChild(a); for (let d = 0; 1 >= d; d++) { const t = e[d], n = document.createElement("DIV"); n.classList.add("col-6"), a.appendChild(n); const r = document.createElement("DIV"); r.classList.add("product-item-container"), r.addEventListener("click", function () { window.open(t.url, "_blank"); }), n.appendChild(r); const i = document.createElement("DIV"); i.classList.add("product-item"), r.appendChild(i); const l = document.createElement("DIV"); l.classList.add("product-item-image"), l.style.backgroundImage = `url(${t.image})`, i.appendChild(l); const s = document.createElement("DIV"); s.classList.add("product-details-wrapper"), r.appendChild(s); const c = document.createElement("P"); c.classList.add("product-name"), c.innerHTML = t.name, s.appendChild(c); const p = document.createElement("EM"); p.classList.add("product-price"), p.innerHTML = t.currency + t.price, s.appendChild(p); } break; } case 3: { const t = document.createElement("DIV"); t.classList.add("three-product-wrapper"), d.appendChild(t); const a = document.createElement("DIV"); a.classList.add("row"), a.classList.add("row-cols-3"), t.appendChild(a); for (let d = 0; 2 >= d; d++) { const t = e[d], n = document.createElement("DIV"); n.classList.add("col"), a.appendChild(n); const r = document.createElement("A"); r.classList.add("product-redirection-link"), r.href = t.url, r.target = "_blank", n.appendChild(r); const i = document.createElement("DIV"); i.classList.add("product-item-container"), r.appendChild(i); const l = document.createElement("DIV"); l.classList.add("product-item"), i.appendChild(l); const s = document.createElement("DIV"); if (s.classList.add("product-item-image"), s.style.backgroundImage = `url(${t.image})`, l.appendChild(s), t.sale) { const e = document.createElement("SPAN"); e.classList.add("onsale"), e.innerHTML = "ON SALE", s.appendChild(e); } const c = document.createElement("DIV"); c.classList.add("product-details-wrapper"), i.appendChild(c); const p = document.createElement("P"); p.classList.add("product-name"), p.innerHTML = t.name, c.appendChild(p); const o = document.createElement("EM"); o.classList.add("product-price"), o.innerHTML = t.currency + t.price, c.appendChild(o); const m = document.createElement("DIV"); m.classList.add("product-details-wrapper-mobile"), i.appendChild(m); const E = document.createElement("P"); E.classList.add("product-name"), E.innerHTML = t.name, m.appendChild(E); const L = document.createElement("EM"); L.classList.add("product-price"), L.innerHTML = t.currency + t.price, m.appendChild(L); } break; } case 4: { const t = document.createElement("DIV"); t.classList.add("four-product-wrapper"), d.appendChild(t); const a = document.createElement("DIV"); a.classList.add("row"), a.classList.add("row-cols-4"), t.appendChild(a); for (let d = 0; 3 >= d; d++) { const t = e[d], n = document.createElement("DIV"); n.classList.add("col"), a.appendChild(n); const r = document.createElement("A"); r.classList.add("product-redirection-link"), r.href = t.url, r.target = "_blank", n.appendChild(r); const i = document.createElement("DIV"); i.classList.add("product-item-container"), r.appendChild(i); const l = document.createElement("DIV"); l.classList.add("product-item"), i.appendChild(l); const s = document.createElement("DIV"); if (s.classList.add("product-item-image"), s.style.backgroundImage = `url(${t.image})`, l.appendChild(s), t.sale) { const e = document.createElement("SPAN"); e.classList.add("onsale"), e.innerHTML = "ON SALE", s.appendChild(e); } const c = document.createElement("DIV"); c.classList.add("product-details-wrapper"), l.appendChild(c); const p = document.createElement("P"); p.classList.add("product-name"), p.innerHTML = t.name, c.appendChild(p); const o = document.createElement("EM"); o.classList.add("product-price"), o.innerHTML = t.currency + t.price, c.appendChild(o); const m = document.createElement("DIV"); m.classList.add("product-details-wrapper-mobile"), i.appendChild(m); const E = document.createElement("P"); E.classList.add("product-name"), E.innerHTML = t.name, m.appendChild(E); const L = document.createElement("EM"); L.classList.add("product-price"), L.innerHTML = t.currency + t.price, m.appendChild(L); } break; } case 5: { const t = document.createElement("DIV"); t.classList.add("five-product-wrapper"), d.appendChild(t); const a = e[0], n = document.createElement("DIV"); n.classList.add("row"), t.appendChild(n); const r = document.createElement("DIV"); r.classList.add("col"), n.appendChild(r); const i = document.createElement("A"); i.classList.add("product-redirection-link"), i.style = "text-decoration: none;", i.href = a.url, i.target = "_blank", r.appendChild(i); const l = document.createElement("DIV"); l.classList.add("product-item-container"), l.addEventListener("click", function () { window.open(a.url, "_blank"); }), i.appendChild(l); const s = document.createElement("DIV"); if (s.classList.add("product-item"), s.style.backgroundImage = `url(${a.image})`, l.appendChild(s), a.sale) { const e = document.createElement("SPAN"); e.classList.add("onsale"), e.innerHTML = "ON SALE", s.appendChild(e); } const c = document.createElement("DIV"); c.classList.add("product-details-wrapper"), s.appendChild(c); const p = document.createElement("B"); p.classList.add("brand-name"), p.innerHTML = BRAND_NAME, c.appendChild(p); const o = document.createElement("P"); o.classList.add("product-name"), o.innerHTML = a.name, c.appendChild(o); const m = document.createElement("EM"); m.classList.add("product-price"), m.innerHTML = a.currency + a.price, c.appendChild(m); let E = 1; for (let d = 1; 2 >= d; d++) { const d = document.createElement("DIV"); d.classList.add("row"), d.classList.add("secondary-product-row"), t.appendChild(d); for (let t = 1; 2 >= t; t++) { const t = e[E], a = document.createElement("DIV"); a.classList.add("col-6"), d.appendChild(a); const n = document.createElement("A"); n.classList.add("product-redirection-link"), n.style = "text-decoration: none;", n.href = t.url, n.target = "_blank", a.appendChild(n); const r = document.createElement("DIV"); r.classList.add("product-item-container"), r.addEventListener("click", function () { window.open(t.url, "_blank"); }), n.appendChild(r); const i = document.createElement("DIV"); if (i.classList.add("product-item"), i.style.backgroundImage = `url(${t.image})`, r.appendChild(i), t.sale) { const e = document.createElement("SPAN"); e.classList.add("onsale"), e.innerHTML = "ON SALE", i.appendChild(e); } const l = document.createElement("DIV"); l.classList.add("product-details-wrapper"), i.appendChild(l); const s = document.createElement("B"); s.classList.add("brand-name"), s.innerHTML = BRAND_NAME, l.appendChild(s); const c = document.createElement("P"); c.classList.add("product-name"), c.innerHTML = t.name, l.appendChild(c); const p = document.createElement("EM"); p.classList.add("product-price"), p.innerHTML = t.currency + t.price, l.appendChild(p), E++; } } break; } case 6: { const t = document.createElement("DIV"); t.classList.add("six-product-wrapper"), d.appendChild(t); let a = 0; for (let d = 1; 3 >= d; d++) { const d = document.createElement("DIV"); d.classList.add("row"), d.classList.add("secondary-product-row"), t.appendChild(d); for (let t = 1; 2 >= t; t++) { const t = e[a], n = document.createElement("DIV"); n.classList.add("col-6"), d.appendChild(n); const r = document.createElement("A"); r.classList.add("product-redirection-link"), r.style = "text-decoration: none;", r.href = t.url, r.target = "_blank", n.appendChild(r); const i = document.createElement("DIV"); i.classList.add("product-item-container"), i.addEventListener("click", function () { window.open(t.url, "_blank"); }), r.appendChild(i); const l = document.createElement("DIV"); if (l.classList.add("product-item"), l.style.backgroundImage = `url(${t.image})`, i.appendChild(l), t.sale) { const e = document.createElement("SPAN"); e.classList.add("onsale"), e.innerHTML = "ON SALE", l.appendChild(e); } const s = document.createElement("DIV"); s.classList.add("product-details-wrapper"), l.appendChild(s); const c = document.createElement("B"); c.classList.add("brand-name"), c.innerHTML = BRAND_NAME, s.appendChild(c); const p = document.createElement("P"); p.classList.add("product-name"), p.innerHTML = t.name, s.appendChild(p); const o = document.createElement("EM"); o.classList.add("product-price"), o.innerHTML = t.currency + t.price, s.appendChild(o), a++; } } break; } default: } }